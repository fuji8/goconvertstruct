# gotypeconverter

gotypeconverterは構造的に異なる二つの型を変換する関数を生成します。与えられた型の要素を再帰的に解析して、一致する型で代入するようなコードを生成します。両者がnamed typeの場合、新たに関数を作成します。作成された関数や出力されるファイルに既に存在していた関数は関数名でソートされます。そのため、出力するファイルを別ける必要はありません。

## Install
```shell
go install github.com/fuji8/gotypeconverter/cmd/gotypeconverter
```

## Usage
```shell
> gotypeconverter                          
gotypeconverter: gotypeconverter generates a function that converts two different named types.

Usage: gotypeconverter [-flag] [package]


Flags:
  -d string
        destination struct
  -o string
        output file; if nil, output stdout
  -pkg string
        output package; if nil, the directoryName and packageName must be same and will be used
  -s string
        source struct
  -structTag string
         (default "cvt")
```

## 注意
パッケージ名とディレクトリ名が一致しない場合は、`-pkg`で該当するパッケージ名を指定してください。



## 変換規約
basic, named, struct, slice, pointer(wip)に対しては、特別な処理を行います。その他の型については、完全一致のみです。

https://github.com/fuji8/gotypeconverter/blob/v0.1.0/gotypeconverter.go#L449-L543

変換は、このswitch文によって行われます。

関数は、`XAndOther` `OtherAndX` `XAndX`の3タイプで構成されています。(X$\in$ {basic, named, struct, slice, pointer})`XAndOther`は、dstの型がXでsrcの型がその他の型であるときの処理です。`XAndOther` `OtherAndX`は、dstとsrcが逆なだけで意味的にはほぼ同一です。`XAndX`は、両者の型がXであるときの処理です。

### Basic

特別な処理はない。



### Named

`underlying()`する。

#### `namedAndOther` `OtherAndNamed` `namedAndNamed`

`underlying()`して再帰。



### Struct

フィールドを見る。埋め込みは、そこにあるように。

#### `structAndOther` `OtherAndStruct` 

その他がstructのフィールドに含まれるとして再帰します。あるフィールドで書き込めた時点で、それ以上再帰を呼び出すのをやめます。

```go
type x string

type bar struct {
    y string
    z string
}
```

これに対しては、以下のように最初に来るものに対して代入を成立させて、後のを無視します。

```shell
> gotypeconverter -s x -d bar -pkg foo .
// Code generated by gotypeconverter; DO NOT EDIT.
package foo

func ConvertxTobar(src x) (dst bar) {
        dst.y = src
        return
}
```

#### `structAndStruct`

両者のフィールドを一つずつ見ていき、フィールド名（または存在すれば`cvt`の構造体タグや指定したものが優先）が一致したとき再帰します。

また、次の構造体タグは特別な意味を持ちます。
|種類|意味|
| - | - |
| `-` | 無視 |
| `->` | 読み込み限定（`src`としてのみ意味を持つ）|
| `<-` | 書き込み限定（`dst`としてのみ意味を持つ）|

複数のタグを指定する時は、`, `で区切ってください。


### Slice

`Elem()`を見る。

#### `sliceAndOther` `otherAndSlice`

1番目の要素を見る。

#### `sliceAndSlice`

srcの分だけforでループ。



### Pointer (WIP)

selectorを`(*%s)`して、`Elem()`を見る。